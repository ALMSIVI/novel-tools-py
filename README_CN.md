# 小说整理工具

## 为什么要做这个工具

首先声明，本人支持正版，在可能的情况下，请上官网订阅作者。我的这套工具基本都用于全本订阅的小说。

但是，起点等网站会因各种原因下架小说的部分/全部章节，严重影响阅读体验。在这种情况下，不得不在网络上下载txt版本。txt本身没有格式，即使部分阅读软件有格式匹配能够自动生成目录，但部分问题仍然无法解决：

- 无法支持自定义格式的卷名/章节名。

某些小说可能不会采用正统的章节名。例如：「少女之战第X幕」。

- 由于作者疏忽，章节名会有重复/遗漏。

例如出现两个100章，或者100章之后直接变成102章。

- 章节名字的格式不规则。

比如中文数字与阿拉伯数字混用，或者「章」后面事否有空格。

对于强迫症患者来说，这是无法接受的。虽然每个小说的问题各不相同，无法开发一套通用的脚本来处理，但是脚本至少可以对章节进行简单的自动分割，再进行手动调整。

## 额外库

你需要`natsort`来对中文卷/章节名进行排序。

```shell
pip install natsort
```

## 使用方法

- 所有的脚本都有`argparse`，可以通过`-h`参数来查看使用指南。

小说下载下来之后，先删去前后的网站声明、书名、简介等无关内容，只留下卷名和章节名。同时确保文件为**utf8**编码，而非gb2312。

然后使用`split.py`拆分章节。该脚本能够将txt文件分拆成单个的Markdown文件，其中标题会用**h1**表示在第一行。如果该小说有分卷，那么脚本能够识别简单的卷名，并将每一卷中的章节放在单独的文件夹内。

拆分章节后，需要手动校对目录、分卷信息，确保章节数和文件数统一。

如果分卷的名字不规则，不符合自然排序规则，那么需要手动排序。为此，你需要一个单独的文件来记录分卷顺序。使用`generate_order.py`来生成一个模板文件`order.json`，然后对分卷进行排序。

如果小说没有分卷，那么使用`concatenate.py`来将章节合并成为一个统一的Markdown文件。如果有分卷，那么使用`concatenate_volume.py`合并成为一个双层级的Markdown文件。

然后，你就可以将整理完成的文件导入到Calibre等电子书管理软件中，统一进行管理，例如转换成更适合于电纸书阅读的epub格式等。
